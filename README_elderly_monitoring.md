# 🏥 노인 활동 모니터링 시스템

MediaPipe를 활용한 AI 기반 노인 활동 모니터링 및 건강 관리 시스템입니다.

## ✨ 주요 기능

### 🎯 실시간 모니터링
- **낙상 감지**: 몸의 기울기, 머리/엉덩이 높이 비율, 급격한 자세 변화를 종합 분석
- **활동량 추적**: 주요 관절의 움직임을 실시간으로 측정하여 활동 수준 분류
- **자세 분석**: 전신 랜드마크를 통한 종합적인 자세 상태 평가
- **비정상 상황 알림**: 장시간 비활성, 저활동 상태 자동 감지

### 📊 데이터 분석 & 리포트
- **일일 활동 리포트**: 활동량, 모니터링 시간, 건강 점수 제공
- **주간 추이 분석**: 7일간 활동 패턴 시각화 및 건강 상태 평가
- **데이터 내보내기**: CSV, JSON 형식으로 데이터 저장 및 관리
- **개인화 권장사항**: AI 기반 맞춤형 건강 관리 조언

### 🚨 응급 상황 대응
- **즉시 알림**: 낙상 감지 시 음성/시각적 경고
- **응급 연락망**: 가족, 돌봄 제공자, 응급실 자동 알림 (설정 시)
- **상황 기록**: 모든 응급 상황을 타임스탬프와 함께 저장

## 🔧 설치 및 설정

### 필수 라이브러리 설치
```bash
# 기본 라이브러리
pip install opencv-python mediapipe numpy

# 선택 사항 (데이터 분석용)
pip install pandas matplotlib

# 이메일 알림용 (선택)
pip install secure-smtplib
```

### 시스템 요구사항
- Python 3.7+
- 웹캠 또는 카메라 장치
- Windows/macOS/Linux 지원

## 🚀 사용법

### 1. 기본 모니터링 실행
```bash
python elderly_monitoring_system.py
```

**조작법:**
- `q` 또는 `ESC`: 종료
- `r`: 실시간 일일 리포트 출력
- `s`: 현재 세션 데이터 저장

### 2. 데이터 분석 실행
```bash
python monitoring_analysis.py
```
7일간의 활동 데이터를 분석하여 차트와 건강 리포트를 자동 생성합니다.

### 3. 설정 커스터마이징
`monitoring_config.py` 파일에서 다음 항목들을 조정할 수 있습니다:

#### 임계값 설정
```python
THRESHOLDS = {
    'FALL_ANGLE_THRESHOLD': 60,      # 낙상 감지 각도
    'INACTIVE_ALERT': 300,           # 비활성 상태 알림 (5분)
    'LOW_ACTIVITY_WARNING': 180,     # 저활동 경고 (3분)
}
```

#### 응급 연락처 설정
```python
EMERGENCY_CONTACTS = {
    'primary_family': {
        'name': '가족 (1차)',
        'phone': '+82-10-1234-5678',
        'email': 'family@example.com'
    }
}
```

## 📈 모니터링 데이터 해석

### 활동 수준 분류
- **휴식 중** (😴): 거의 움직임이 없는 상태
- **조용한 활동** (📖): 읽기, TV 시청 등 정적 활동
- **보통 활동** (🚶): 일상적인 움직임 
- **활발한 활동** (🏃): 운동, 청소 등 동적 활동

### 건강 점수 체계
- **80-100점** (🌟): 우수한 활동 패턴
- **60-79점** (👍): 양호한 상태
- **40-59점** (👌): 보통 수준
- **40점 미만** (⚠️): 주의 필요

### 낙상 위험도
- **✅ 안전**: 정상적인 자세 유지
- **⚠️ 주의**: 1개 위험 요소 감지
- **🚨 낙상 위험**: 2개 이상 위험 요소 동시 감지

## 🎨 화면 구성

### 실시간 모니터링 화면
```
🏥 노인 활동 모니터링
활동 상태: 보통 활동          [초록색: 활발, 노랑: 보통, 빨강: 휴식]
비활성 시간: 02:35           [5분 초과시 빨간색 경고]
낙상 위험도: ✅ 안전          [실시간 위험 평가]
모니터링: 1:23:45           [총 모니터링 시간]
```

### 자세 스켈레톤 표시
- 주요 관절 33개 포인트 실시간 시각화
- 연결선으로 자연스러운 인체 구조 표현
- 움직임에 따른 동적 색상 변화

## 📊 생성되는 파일들

### 데이터 파일
- `elderly_monitoring_YYYYMMDD_HHMMSS.json`: 세션별 상세 데이터
- `weekly_data_YYYYMMDD.csv`: 주간 분석 데이터 (Excel에서 열기 가능)
- `elderly_monitoring.log`: 시스템 로그 파일

### 분석 결과
- `weekly_activity_YYYYMMDD.png`: 활동량 추이 차트
- 일일/주간 건강 리포트 (터미널 출력)

## 🛠️ 고급 설정

### 1. 이메일 알림 설정 (선택사항)
```python
EMAIL_CONFIG = {
    'SMTP_SERVER': 'smtp.gmail.com',
    'SMTP_PORT': 587,
    'EMAIL_ADDRESS': 'your_email@gmail.com',
    'EMAIL_PASSWORD': 'your_app_password'  # Gmail 앱 비밀번호
}
```

### 2. 카메라 설정 최적화
```python
SYSTEM_CONFIG = {
    'CAMERA_WIDTH': 640,    # 해상도 조정으로 성능 최적화
    'CAMERA_HEIGHT': 480,
    'MODEL_COMPLEXITY': 1   # 0:빠름, 1:균형, 2:정확
}
```

### 3. 데이터 보관 정책
```python
DATA_CONFIG = {
    'DATA_RETENTION_DAYS': 30,  # 30일 후 자동 삭제
    'SAVE_INTERVAL': 300,       # 5분마다 자동 저장
    'BACKUP_ENABLED': True      # 백업 폴더에 복사본 생성
}
```

## 🚨 주의사항 및 권장사항

### 설치 환경
- **충분한 조명**: 자세 인식 정확도를 위해 밝은 환경 권장
- **카메라 위치**: 전신이 보이는 적절한 거리와 각도 설정
- **네트워크**: 이메일 알림 사용시 인터넷 연결 필요

### 개인정보 보호
- 모든 데이터는 로컬에만 저장됨 (외부 전송 없음)
- 이메일 알림은 사용자가 직접 설정한 경우에만 동작
- 카메라 영상은 실시간 처리만 하고 저장하지 않음

### 의료적 한계
- 본 시스템은 보조 도구이며 전문적인 의료 진단을 대체할 수 없습니다
- 응급상황 시 즉시 119에 신고하시기 바랍니다
- 지속적인 건강 문제가 있을 경우 의료진과 상담하세요

## 🔧 문제 해결

### 자주 발생하는 문제

**1. 카메라가 감지되지 않을 때**
```bash
# 카메라 테스트
python -c "import cv2; print('카메라 상태:', cv2.VideoCapture(0).isOpened())"
```

**2. 자세 인식이 부정확할 때**
- 조명 개선 (밝은 환경)
- 카메라 각도 조정 (정면 촬영)
- 배경 단순화 (무늬 없는 배경)

**3. 성능이 느릴 때**
```python
# monitoring_config.py에서 설정 변경
SYSTEM_CONFIG['MODEL_COMPLEXITY'] = 0  # 빠른 모드
SYSTEM_CONFIG['CAMERA_WIDTH'] = 320    # 낮은 해상도
```

**4. 메모리 부족 시**
```python
# 히스토리 사이즈 축소
SYSTEM_CONFIG['POSE_HISTORY_SIZE'] = 150      # 기본: 300
SYSTEM_CONFIG['ACTIVITY_HISTORY_SIZE'] = 900  # 기본: 1800
```

## 📞 지원 및 문의

### 기술 지원
- MediaPipe 관련: [공식 문서](https://mediapipe.dev/)
- OpenCV 관련: [OpenCV 문서](https://opencv.org/)

### 추가 개발 아이디어
- 음성 인식 통합 (말걸기 기능)
- 스마트폰 앱과 연동
- 웨어러블 디바이스 데이터 통합
- 복약 알림 기능
- 가족/돌봄자용 대시보드

---

**🏥 건강한 노후를 위한 스마트 케어 솔루션**  
*본 시스템은 교육 및 연구 목적으로 개발되었으며, 실제 의료 환경 적용시에는 추가적인 검증과 승인이 필요합니다.*
